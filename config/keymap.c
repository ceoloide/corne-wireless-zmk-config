/*
Copyright 2019 @foostan
Copyright 2020 Drashna Jaelre <@drashna>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

/*
For a graphical representation of the keymap:

http://www.keyboard-layout-editor.com/#/gists/bc418d514191c1481122033579dd3d2e
*/

#include QMK_KEYBOARD_H
#include <stdio.h>

enum crkbd_layers {
    _BASE,
    _LOWER,
    _RAISE,
    _ADJUST,
};

#define RAISE_T(kc) LT(_RAISE, kc)
#define LOWER_T(kc) LT(_LOWER, kc)
#define ADJUST_T(kc) LT(_ADJUST, kc)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
	[_BASE] = LAYOUT_split_3x6_3(
		LCTL_T(KC_GRV), KC_Q, KC_W, KC_E, KC_R, KC_T, 			KC_Y, KC_U, KC_I, KC_O, KC_P, RCTL_T(KC_BSPC),
		LALT_T(KC_TAB), KC_A, KC_S, KC_D, KC_F, KC_G, 			KC_H, KC_J, KC_K, KC_L, KC_SCLN, RGUI_T(KC_QUOT), 
		KC_LSFT, KC_Z, KC_X, KC_C, KC_V, KC_B, 				    KC_N, KC_M, KC_COMM, KC_DOT, KC_SLSH, KC_RSFT,
		LGUI_T(KC_ESC), LOWER_T(KC_TAB), RAISE_T(KC_ENT),       LOWER_T(KC_SPC), RAISE_T(KC_BSPC), RALT_T(KC_DEL)
		),
	[_LOWER] = LAYOUT_split_3x6_3(
        LCTL_T(KC_EQL), KC_1, KC_2, KC_3, KC_4, KC_5, 					KC_6, KC_7, KC_8, KC_9, KC_0, RCTL_T(KC_LBRC),
		LALT_T(KC_UNDS), KC_EXLM, KC_AT, KC_HASH, KC_DLR, KC_PERC, 		KC_CIRC, KC_AMPR, KC_ASTR, KC_LPRN, KC_RPRN, RGUI_T(KC_RBRC), 
		_______, KC_UNDS, KC_PLUS, KC_PIPE, KC_LCBR, KC_RCBR,           KC_LBRC, KC_RBRC, KC_MINS, KC_EQL, KC_BSLS, _______,  
        _______, _______, ADJUST_T(KC_ENT),                             _______, ADJUST_T(KC_BSPC), _______
		),
	[_RAISE] = LAYOUT_split_3x6_3(
		_______, _______, _______, _______, _______, _______,           KC_HOME, KC_PGUP, KC_UP, KC_PGDN, KC_END, _______, 
		_______, _______, _______, _______, _______, _______,           LALT(KC_LEFT), KC_LEFT, KC_DOWN, KC_RGHT, LALT(KC_RGHT), _______, 
		_______, _______, _______, _______, _______, _______,           _______, _______, KC_DOWN, _______, _______, _______,
		_______, ADJUST_T(KC_TAB), _______,                             ADJUST_T(KC_SPC), _______, _______
		),
	[_ADJUST] = LAYOUT_split_3x6_3(
		KC_CAPS, _______, _______, RGB_VAI, _______, _______,				_______, _______, KC_VOLU, _______, _______, DT_UP, 
		_______, _______, _______, RGB_TOG, _______, _______,			 	_______, _______, KC_MUTE, _______, _______, DT_PRNT,
		CG_TOGG, _______, _______, RGB_VAD, _______, _______, 				_______, _______, KC_VOLD, _______, _______, DT_DOWN, 
		_______, _______, _______,                                          _______, _______, _______
		)
};

#ifdef OLED_ENABLE

void oled_render_logo(void) {
    static const char PROGMEM moon_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x78, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xa0, 0x18, 0xa0, 0x40, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x20, 0x60, 0xb8, 0xf8, 0x3c, 0x34, 0xf4, 0x7c, 0x7c, 0xfc, 0xac, 0x4c, 0x78, 0x58, 0xf0, 0xe1, 0x80, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x32, 0x02, 0x01, 0xc7, 0x7f, 0x1f, 0x2e, 0x33, 0x3b, 0x3c, 0xe7, 0xcf, 0xff, 0x9e, 0x1e, 0xbf, 0x7f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x02, 0x02, 0x00, 0x01, 0x01, 0x05, 0x01, 0x00, 0x00, 0x01, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

    oled_write_raw_P(moon_logo, sizeof(moon_logo));
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) { return OLED_ROTATION_270; }

led_t led_usb_state;

static void print_logo_narrow(void) {
    oled_render_logo();
    oled_set_cursor(0, 14);
    oled_write("ceo",false);
    oled_set_cursor(0, 15);
    oled_write("loide",false);
}

/* 32 * 14 os logos */
static const char PROGMEM windows_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xbc, 0xbc, 0xbe, 0xbe, 0x00, 0xbe, 0xbe, 0xbf, 0xbf, 0xbf, 0xbf, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x0f, 0x0f, 0x00, 0x0f, 0x0f, 0x1f, 0x1f, 0x1f, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM mac_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xf0, 0xf8, 0xf8, 0xf8, 0xf0, 0xf6, 0xfb, 0xfb, 0x38, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x0f, 0x1f, 0x1f, 0x0f, 0x0f, 0x1f, 0x1f, 0x0f, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM funtion_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7d, 0xf9, 0xf1, 0xe1, 0xc1, 0x81, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xf0, 0xf8, 0xfc, 0xbe, 0x9f, 0x8f, 0x87, 0x83, 0x81, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM home_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xf0, 0xf0, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xe0, 0xf0, 0xf8, 0xfc, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM command_logo[] = {0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xe0, 0x70, 0x70, 0x70, 0xf0, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0xf0, 0x70, 0x70, 0x70, 0xe0, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0f, 0x1f, 0x1c, 0x18, 0x18, 0x18, 0xff, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0xff, 0x18, 0x18, 0x18, 0x1c, 0x1f, 0x0f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xf0, 0xf8, 0x38, 0x18, 0x18, 0x18, 0xff, 0xff, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xff, 0xff, 0x18, 0x18, 0x18, 0x38, 0xf8, 0xf0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x07, 0x0e, 0x0e, 0x0e, 0x0f, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x0f, 0x0e, 0x0e, 0x0e, 0x07, 0x07, 0x01, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM rocket_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xc0, 0xe0, 0xe0, 0xf0, 0xf0, 0xf0, 0xf8, 0xf8, 0xf8, 0xf8, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x70, 0x78, 0xfc, 0xfe, 0x3e, 0x0f, 0x87, 0xe1, 0xf8, 0xfc, 0xfe, 0xff, 0xff, 0xe7, 0xc3, 0x81, 0x81, 0xc3, 0xe7, 0xff, 0xff, 0x3f, 0x1f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0xf0, 0xf0, 0xf0, 0xf0, 0xe3, 0xc7, 0x0f, 0x1f, 0x3f, 0x3f, 0x3f, 0x1f, 0x9f, 0x8f, 0xcf, 0xe7, 0xe3, 0x71, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x1f, 0x1f, 0x1f, 0x0f, 0x0f, 0x0f, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x03, 0x1f, 0x1f, 0x0f, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM capslock_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xf0, 0x78, 0x3c, 0x1e, 0x0f, 0x0f, 0x1e, 0x3c, 0x78, 0xf0, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe1, 0xe1, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe1, 0xe1, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static const char PROGMEM normalcaps_logo[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xf0, 0x78, 0x78, 0xf0, 0xe0, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x0e, 0x0f, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0f, 0x0e, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
void oled_render_layer_state(void) {

    oled_set_cursor(0, 0);

    /* Print current layer */
    oled_write("LAYER", false);

    switch (get_highest_layer(layer_state)) {
        case _BASE:
            oled_write_raw_P(home_logo, sizeof(home_logo));
            break;
        case _LOWER:
            oled_write_raw_P(funtion_logo, sizeof(funtion_logo));
            break;
        case _RAISE:
            oled_write_raw_P(command_logo, sizeof(command_logo));
            break;
        case _ADJUST:
            oled_write_raw_P(rocket_logo, sizeof(rocket_logo));
            break;
        default:
            oled_write_raw_P(rocket_logo, sizeof(rocket_logo));
    }

    /* Print caps lock state */
    oled_set_cursor(0, 6);
    oled_write("CPSLK", false);
    // if(led_usb_state.caps_lock) {
    if(host_keyboard_led_state().caps_lock){    
        oled_write_raw_P(capslock_logo, sizeof(capslock_logo));
    } else {
        oled_write_raw_P(normalcaps_logo, sizeof(normalcaps_logo));
    }

    /* Print current OS mode */
    oled_set_cursor(1, 11);
    oled_write("SYS", false);
    oled_set_cursor(0, 13);
    if (keymap_config.swap_lctl_lgui) {
       oled_write_raw_P(windows_logo, sizeof(windows_logo));
    } else {
       oled_write_raw_P(mac_logo, sizeof(mac_logo));
    }
}

bool oled_task_user(void) {
    if (is_keyboard_master()) {
        oled_render_layer_state();
    } else {
        print_logo_narrow();
    }
    return false;
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  return true;
}

#endif // OLED_ENABLE

uint32_t layer_state_set_user(uint32_t state) {
#ifdef RGBLIGHT_ENABLE
    switch (biton32(state)) {
        case _BASE:
            rgblight_sethsv_noeeprom(HSV_GREEN);
            rgblight_mode_noeeprom(RGBLIGHT_MODE_STATIC_LIGHT);
            break;
        case _RAISE:
            rgblight_sethsv_noeeprom(HSV_RED);
            rgblight_mode_noeeprom(RGBLIGHT_MODE_STATIC_LIGHT);
            break;
        case _LOWER:
            rgblight_sethsv_noeeprom(HSV_TEAL);
            rgblight_mode_noeeprom(RGBLIGHT_MODE_STATIC_LIGHT);
            break;
        case _ADJUST:
            rgblight_sethsv_noeeprom(HSV_BLUE);
            rgblight_mode_noeeprom(RGBLIGHT_MODE_STATIC_LIGHT);
            break;
        default:
            rgblight_sethsv_noeeprom(HSV_GREEN);
            rgblight_mode_noeeprom(RGBLIGHT_MODE_STATIC_LIGHT);
    }
#endif // RGBLIGHT_ENABLE
  return state;
}